function StateSave(){localStorage.state=JSON.stringify(STORAGE)}function LoadState(){try{STORAGE=JSON.parse(localStorage.state)}catch(e){}}function inherit(e,t){return this._inherits&&-1==this._inherits.indexOf(e)?(e.apply(this,t),void this._inherits.push(e)):0}function getSelf(e){return e._inherits=e._inherits||[],e.inherit=inherit,e}function BaseModel(){getSelf(this)}function Parking(){var e=getSelf(this);e.inherit(BaseModel),e.init=function(){e.priority_by_tag={},e.slot_by_type={}},e._getSlotByTag=function(t){var i=1/0,n=null;for(var r in e.slot_by_type){var o=e.slot_by_type[r],a=o.getPriorityFor(t);if(-1!=a){if(0==a)return o;(!n||i>a)&&(i=a,n=o)}}return n},e._getSlotByVehicle=function(t){for(var i=null,n=0;n<t.taglist.length;n++){var r=t.taglist[n];if(i=e._getSlotByTag(r))return i}return i},e.addSlots=function(t,i,n){e.slot_by_type[t]=new SlotSet({max:i,tagqueue:n})},e.register=function(t){var i=e._getSlotByVehicle(t);return i?void i.addVehicle(t):(console.log("No place for ",t),!1)},e.clear=function(e){},e.clearAll=function(){},e.restoreState=function(){},e.saveState=function(){},e.yieldState=function(){for(k in e.slot_by_type)console.log(["\nState for ",k," parking group"].join("")),e.slot_by_type[k].yieldState()},e.init()}function SlotSet(e){var t=getSelf(this);t.inherit(BaseModel),t.init=function(){t.has=0,t.max=e.max||0,t.tagqueue=e.tagqueue||[],t.vehicles=new Array(t.max)},t.addVehicle=function(e){if(t.has==t.max)return!1;for(var i=0;void 0!=t.vehicles[i];i++);t.vehicles[i]=e,t.has+=1},t.removeVehicle=function(e){},t.getPriorityFor=function(e){return t.has==t.max?-1:t.tagqueue.indexOf(e)},t.yieldState=function(){console.log(["Currently filled with ",t.has,"/",t.max," vehicles: {"].join(""));for(var e=0;e<t.vehicles.length;e++){var i=t.vehicles[e];void 0==i?console.log("	---------"):console.log(["	",i.id," ",i.taglist.join(", ")].join(""))}console.log("}")},t.init()}function Tag(e){this.name=e,TAG[e]=this}function toLen(e,t){return new Array(t-e.length+1).join("0")+e}function Vehicle(e){var t=getSelf(this);t.inherit(BaseModel),t.init=function(){t.id="VH-"+carIter.get(),t.taglist=e},t.copy=function(){return new Vehicle(e.slice())},t.init()}function declareInstances(){"Truck,Sedan,Disabled".split(",").map(function(e){new Tag(e)}),window.parking=new Parking,parking.addSlots("Trucks",10,[TAG.Truck,null,TAG.Disabled,TAG.Sedan]),parking.addSlots("Disabled",5,[TAG.Disabled]),parking.addSlots("Simple",15,[TAG.Sedan,TAG.Disabled]),window.dummy_Truck=new Vehicle([TAG.Truck]),window.dummy_Sedan=new Vehicle([TAG.Sedan]),window.dummy_Disabled=new Vehicle([TAG.Disabled])}function mainScenario(){parking.restoreState(),parking.yieldState()}function fixtureFillScenario(e){e=e||30;for(var t=Object.keys(TAG),i=0;e>i;i++){var n=TAG[t[parseInt(Math.random()*t.length)]];parking.register(new Vehicle([n]))}}window.STORAGE={},window.TAG={},Tag.prototype.toString=function(){return this.name},window.carIter={num:41,get:function(){return toLen((carIter.num+=1).toString(),4)}},declareInstances(),fixtureFillScenario(),mainScenario();